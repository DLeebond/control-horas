<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Horas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root {
    --bg: #f5f5f5;
    --card: #ffffff;
    --text: #222;
    --entrada: #d8f5d1;
    --salida: #ffd4cc;
    --border: #ddd;
  }

  body.dark {
    --bg: #121212;
    --card: #1f1f1f;
    --text: #eaeaea;
    --entrada: #295f2f;
    --salida: #6e2720;
    --border: #333;
  }

  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s, color 0.3s;
  }

  .app {
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  header {
    padding: 16px;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    background: var(--card);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    position: relative;
  }

  #modoOscuroBtn {
    position: absolute;
    right: 16px;
    top: 14px;
    background: none;
    border: none;
    font-size: 22px;
    cursor: pointer;
    color: var(--text);
  }

  .tabs {
    display: flex;
    background: var(--card);
    border-bottom: 1px solid var(--border);
  }

  .tab-btn {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    border: none;
    background: none;
    color: var(--text);
  }

  .tab-btn.active {
    border-bottom: 3px solid var(--text);
  }

  .panel {
    display: none;
    padding: 16px;
  }
  .panel.active {
    display: block;
  }

  .btn {
    width: 100%;
    padding: 16px;
    font-size: 18px;
    margin: 10px 0;
    border: none;
    border-radius: 12px;
    color: #000;
  }
  .entrada { background: var(--entrada); }
  .salida  { background: var(--salida); }

  .contador, .stats, .lista {
    background: var(--card);
    padding: 14px;
    border-radius: 12px;
    margin-top: 12px;
    border: 1px solid var(--border);
    transition: background 0.3s, color 0.3s;
  }

  .lista ul { list-style: none; padding: 0; margin: 0; }
  .lista li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
  }
  .lista li:last-child { border-bottom: none; }

  .borrar {
    color: red;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
  }
</style>
</head>

<body>

<div class="app" id="app">

<header>
  Control de horas
  <button id="modoOscuroBtn">üåô</button>
</header>

<div class="tabs">
  <button id="tabNormal" class="tab-btn active">Normales</button>
  <button id="tabExtra" class="tab-btn">Extras</button>
</div>

<!-- NORMALES -->
<div id="panelNormal" class="panel active">
  <button id="normEntrada" class="btn entrada">Entrada</button>
  <button id="normSalida" class="btn salida">Salida</button>

  <div id="contadorNormal" class="contador">Contador: 0h 0m 0s</div>

  <div class="stats">
    <p id="normHoy">Hoy: 0 h</p>
    <p id="normTotal">Total: 0 h</p>
  </div>

  <div class="lista">
    <h3>Registros Normales</h3>
    <ul id="normLista"></ul>
  </div>
</div>

<!-- EXTRAS -->
<div id="panelExtra" class="panel">
  <button id="extraEntrada" class="btn entrada">Entrada Extra</button>
  <button id="extraSalida" class="btn salida">Salida Extra</button>

  <div id="contadorExtra" class="contador">Contador: 0h 0m 0s</div>

  <div class="stats">
    <p id="extraHoy">Hoy: 0 h</p>
    <p id="extraTotal">Total: 0 h</p>
  </div>

  <div class="lista">
    <h3>Registros Extras</h3>
    <ul id="extraLista"></ul>
  </div>
</div>

</div>

<script>
/* ----------------------------
   MODO OSCURO
----------------------------- */
const body = document.body;
const btnOscuro = document.getElementById("modoOscuroBtn");

if (localStorage.getItem("modoOscuro") === "true") {
  body.classList.add("dark");
  btnOscuro.textContent = "‚òÄÔ∏è";
}

btnOscuro.onclick = () => {
  body.classList.toggle("dark");
  const activo = body.classList.contains("dark");
  btnOscuro.textContent = activo ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("modoOscuro", activo);
};


/* ----------------------------
   CAMBIO ENTRE TABS
----------------------------- */
const tabNormal = document.getElementById("tabNormal");
const tabExtra  = document.getElementById("tabExtra");
const panelNormal = document.getElementById("panelNormal");
const panelExtra  = document.getElementById("panelExtra");

let vistaActual = "normal";

function mostrarVista(v) {
  vistaActual = v;
  tabNormal.classList.toggle("active", v === "normal");
  tabExtra.classList.toggle("active", v === "extra");
  panelNormal.classList.toggle("active", v === "normal");
  panelExtra.classList.toggle("active", v === "extra");
}

tabNormal.onclick = () => mostrarVista("normal");
tabExtra.onclick  = () => mostrarVista("extra");


/* ----------------------------
   DESLIZAR ENTRE VISTAS
----------------------------- */
let startX = 0;

document.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
});

document.addEventListener("touchend", e => {
  let diff = e.changedTouches[0].clientX - startX;
  if (Math.abs(diff) > 60) {
    if (diff < 0 && vistaActual === "normal") mostrarVista("extra");
    if (diff > 0 && vistaActual === "extra") mostrarVista("normal");
  }
});


/* ----------------------------
   CONTROL GENERAL HORAS
----------------------------- */
function controlador(tipo) {
  const prefix = tipo === "normal" ? "norm" : "extra";

  const btnEntrada = document.getElementById(prefix + "Entrada");
  const btnSalida  = document.getElementById(prefix + "Salida");

  const lblHoy   = document.getElementById(prefix + "Hoy");
  const lblTotal = document.getElementById(prefix + "Total");
  const lblCont  = document.getElementById("contador" + (tipo === "normal" ? "Normal" : "Extra"));
  const listaUL  = document.getElementById(prefix + "Lista");

  const KEY_TOTAL = prefix + "_total";
  const KEY_REGS  = prefix + "_regs";

  let total = parseFloat(localStorage.getItem(KEY_TOTAL)) || 0;
  let registros = JSON.parse(localStorage.getItem(KEY_REGS)) || [];

  let horaEntrada = null;
  let timer = null;

  function refrescarLista() {
    listaUL.innerHTML = "";
    registros.forEach((r, i) => {
      let li = document.createElement("li");
      li.innerHTML = `${r} <span class="borrar" data-i="${i}">‚ùå</span>`;
      listaUL.appendChild(li);
    });
  }

  refrescarLista();
  lblTotal.textContent = "Total: " + total + " h";

  // CONFIRMAR ANTES DE ELIMINAR
  listaUL.onclick = e => {
    if (e.target.classList.contains("borrar")) {
      let i = e.target.getAttribute("data-i");

      if (confirm("¬øSeguro que quieres eliminar este registro?")) {
        registros.splice(i, 1);
        localStorage.setItem(KEY_REGS, JSON.stringify(registros));
        refrescarLista();
      }
    }
  };

  // ENTRADA
  btnEntrada.onclick = () => {
    horaEntrada = Date.now();
    clearInterval(timer);

    timer = setInterval(() => {
      let ms = Date.now() - horaEntrada;
      let h = Math.floor(ms / 3600000);
      let m = Math.floor((ms % 3600000) / 60000);
      let s = Math.floor((ms % 60000) / 1000);

      lblCont.textContent = `Contador: ${h}h ${m}m ${s}s`;
    }, 1000);
  };

  // SALIDA
  btnSalida.onclick = () => {
    if (!horaEntrada) return;

    clearInterval(timer);

    let ms = Date.now() - horaEntrada;
    let horas = (ms / 3600000).toFixed(2);

    lblHoy.textContent = "Hoy: " + horas + " h";

    total = (parseFloat(total) + parseFloat(horas)).toFixed(2);
    lblTotal.textContent = "Total: " + total + " h";
    localStorage.setItem(KEY_TOTAL, total);

    let fecha = new Date().toLocaleDateString();
    registros.push(`${fecha} ¬∑ ${horas} h`);
    localStorage.setItem(KEY_REGS, JSON.stringify(registros));

    refrescarLista();

    lblCont.textContent = "Contador: 0h 0m 0s";
    horaEntrada = null;
  };
}

controlador("normal");
controlador("extra");
</script>

</body>
</html>